os: linux
language: go
go:
- 1.13.x
env:
- IMAGE_NAME=thorsager/go-direct

services:
- docker

jobs:
  include:
  - stage: test
    script: make test
  - stage: build docker image
    if: NOT branch == master
    script:
    - ./scripts/docker_build.sh -n "${TRAVIS_BUILD_ID}"
    - ./scripts/docker_tag.sh -s "${TRAVIS_BUILD_ID}" -t "${IMAGE_NAME}:${TRAVIS_BRANCH}"
    - ./scripts/docker_push.sh -l -n "${IMAGE_NAME}:${TRAVIS_BRANCH}"
